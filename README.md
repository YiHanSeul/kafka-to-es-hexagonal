# π—οΈ Kafka to Elasticsearch - ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ² ν”„λ΅μ νΈ

μΉ΄ν”„μΉ΄μ—μ„ λ©”μ‹μ§€λ¥Ό consumeν•΄μ„ Elasticsearchλ΅ μƒ‰μΈν•λ” μ• ν”λ¦¬μΌ€μ΄μ…μ„ ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ²λ΅ κµ¬ν„ν•©λ‹λ‹¤.

## π“ ν•™μµ λ©ν‘

1. **ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ²** μ΄ν•΄ν•κ³  μ‹¤μ „ μ μ©
2. **Kafka Consumer** κµ¬ν„
3. **Elasticsearch** μƒ‰μΈ μ²λ¦¬
4. **Kotlin + μ½”λ£¨ν‹΄** ν™μ©
5. **λ„μ»¤ ν™κ²½** κµ¬μ„± λ° κ΄€λ¦¬

---

## π― ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ²λ€?

### ν•µμ‹¬ κ°λ…
```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚         μ™Έλ¶€ μ„Έκ³„ (Infrastructure)        β”‚
β”‚  β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”      β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚  β”‚   Kafka     β”‚      β”‚ Elasticsearch β”‚  β”‚
β”‚  β”‚  Adapter    β”‚      β”‚   Adapter     β”‚  β”‚
β”‚  β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”      β””β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”  β”‚
β”‚         β”‚                    β”‚          β”‚
β”‚    β”β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”   β”‚
β”‚    β”‚      Port (Interface)         β”‚   β”‚
β”‚    β””β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”¬β”€β”€β”€β”€β”€β”   β”‚
β”‚         β”‚                    β”‚          β”‚
β”‚    β”β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β–Όβ”€β”€β”€β”€β”€β”   β”‚
β”‚    β”‚   Domain (λΉ„μ¦λ‹μ¤ λ΅μ§)       β”‚   β”‚
β”‚    β”‚   - κΈ°μ  μμ΅΄μ„± μ—†μ           β”‚   β”‚
β”‚    β”‚   - μμν• λΉ„μ¦λ‹μ¤ κ·μΉ™       β”‚   β”‚
β”‚    β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”   β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

### μ£Όμ” κµ¬μ„±μ”μ†

1. **Domain (λ„λ©”μΈ)**
   - λΉ„μ¦λ‹μ¤ λ΅μ§λ§ μ΅΄μ¬
   - μ™Έλ¶€ κΈ°μ (Kafka, ES λ“±)μ— λ€ν•΄ λ°λΌμ”
   - μ: `Message`, `MessageProcessor`

2. **Port (ν¬νΈ)**
   - μΈν„°νμ΄μ¤ (κ³„μ•½μ„)
   - Inbound Port: μ™Έλ¶€μ—μ„ λ„λ©”μΈμΌλ΅ λ“¤μ–΄μ¤λ” μ”μ²­
   - Outbound Port: λ„λ©”μΈμ—μ„ μ™Έλ¶€λ΅ λ‚κ°€λ” μ”μ²­

3. **Adapter (μ–΄λ‘ν„°)**
   - Portμ μ‹¤μ  κµ¬ν„
   - κΈ°μ μ μΈ μ„Έλ¶€μ‚¬ν•­ λ‹΄λ‹Ή
   - μ: KafkaConsumerAdapter, ElasticsearchAdapter

---

## π“‚ ν”„λ΅μ νΈ κµ¬μ΅°

```
kafka-to-es-hexagonal/
β”β”€β”€ docker-compose.yml          # μΈν”„λΌ ν™κ²½ μ„¤μ •
β”β”€β”€ Dockerfile                  # Elasticsearch + Nori
β”β”€β”€ README.md                   # μ΄ νμΌ
β”β”€β”€ build.gradle.kts            # Gradle λΉλ“ μ„¤μ •
β”β”€β”€ settings.gradle.kts
β””β”€β”€ src/
    β””β”€β”€ main/
        β”β”€β”€ kotlin/
        β”‚   β””β”€β”€ com/
        β”‚       β””β”€β”€ example/
        β”‚           β””β”€β”€ kafkaes/
        β”‚               β”β”€β”€ domain/                    # π― λ„λ©”μΈ (ν•µμ‹¬)
        β”‚               β”‚   β”β”€β”€ model/
        β”‚               β”‚   β”‚   β””β”€β”€ Message.kt         # λ©”μ‹μ§€ λ¨λΈ
        β”‚               β”‚   β”β”€β”€ port/
        β”‚               β”‚   β”‚   β”β”€β”€ inbound/
        β”‚               β”‚   β”‚   β”‚   β””β”€β”€ MessageProcessor.kt   # λ©”μ‹μ§€ μ²λ¦¬ (λΉ„μ¦λ‹μ¤ λ΅μ§)
        β”‚               β”‚   β”‚   β””β”€β”€ outbound/
        β”‚               β”‚   β”‚       β”β”€β”€ MessageConsumer.kt    # λ©”μ‹μ§€ λ°›κΈ° μΈν„°νμ΄μ¤
        β”‚               β”‚   β”‚       β””β”€β”€ MessageIndexer.kt     # μƒ‰μΈν•κΈ° μΈν„°νμ΄μ¤
        β”‚               β”‚   β””β”€β”€ service/
        β”‚               β”‚       β””β”€β”€ MessageProcessingService.kt  # λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤
        β”‚               β”‚
        β”‚               β”β”€β”€ adapter/                   # π” μ–΄λ‘ν„° (κΈ°μ  κµ¬ν„)
        β”‚               β”‚   β”β”€β”€ inbound/
        β”‚               β”‚   β”‚   β””β”€β”€ kafka/
        β”‚               β”‚   β”‚       β””β”€β”€ KafkaConsumerAdapter.kt  # Kafkaμ—μ„ λ©”μ‹μ§€ λ°›κΈ°
        β”‚               β”‚   β””β”€β”€ outbound/
        β”‚               β”‚       β””β”€β”€ elasticsearch/
        β”‚               β”‚           β””β”€β”€ ElasticsearchAdapter.kt  # ESλ΅ μƒ‰μΈν•κΈ°
        β”‚               β”‚
        β”‚               β”β”€β”€ config/                    # β™οΈ μ„¤μ •
        β”‚               β”‚   β”β”€β”€ KafkaConfig.kt
        β”‚               β”‚   β””β”€β”€ ElasticsearchConfig.kt
        β”‚               β”‚
        β”‚               β””β”€β”€ Application.kt             # π€ λ©”μΈ μ• ν”λ¦¬μΌ€μ΄μ…
        β”‚
        β””β”€β”€ resources/
            β””β”€β”€ application.yml                        # μ„¤μ • νμΌ
```

---

## π€ λ‹¨κ³„λ³„ κµ¬ν„ κ³„ν

### β… 1λ‹¨κ³„: ν™κ²½ κµ¬μ„± (μ™„λ£)
- [x] docker-compose.yml μ‘μ„±
- [x] Dockerfile μ‘μ„± (Nori ν”λ¬κ·ΈμΈ)
- [x] ν”„λ΅μ νΈ κµ¬μ΅° μ„¤κ³„

### π“ 2λ‹¨κ³„: λ„λ©”μΈ λ¨λΈ (λ‹¤μ!)
- [ ] Message λ¨λΈ λ§λ“¤κΈ°
- [ ] Port μΈν„°νμ΄μ¤ μ •μ
- [ ] λΉ„μ¦λ‹μ¤ μ„λΉ„μ¤ κµ¬ν„

### π” 3λ‹¨κ³„: Kafka Adapter
- [ ] KafkaConsumerAdapter κµ¬ν„
- [ ] μ„¤μ • νμΌ μ‘μ„±
- [ ] ν…μ¤νΈ

### π“ 4λ‹¨κ³„: Elasticsearch Adapter
- [ ] ElasticsearchAdapter κµ¬ν„
- [ ] μΈλ±μ¤ μƒμ„±
- [ ] μƒ‰μΈ λ΅μ§ κµ¬ν„

### π‰ 5λ‹¨κ³„: ν†µν•© λ° μ‹¤ν–‰
- [ ] μ• ν”λ¦¬μΌ€μ΄μ… μ΅°λ¦½
- [ ] End-to-End ν…μ¤νΈ
- [ ] λ¨λ‹ν„°λ§ (Kafka UI, Kibana)

---

## π› οΈ μ‹μ‘ν•κΈ°

### 1. μΈν”„λΌ μ‹¤ν–‰
```bash
docker-compose up -d
```

### 2. μ„λΉ„μ¤ ν™•μΈ
- Kafka UI: http://localhost:8080
- Elasticsearch: http://localhost:9200
- Kibana: http://localhost:5601

### 3. μ• ν”λ¦¬μΌ€μ΄μ… μ‹¤ν–‰
```bash
./gradlew run
```

---

## π’΅ ν•™μµ ν

### ν—¥μ‚¬κ³ λ‚  μ•„ν‚¤ν…μ² μ΄ν•΄ν•κΈ°

**β λ‚μ μ (μμ΅΄μ„±μ΄ μ„μ—¬μμ)**
```kotlin
class MessageService {
    fun process(message: KafkaRecord) {  // Kafkaμ— μμ΅΄!
        // λΉ„μ¦λ‹μ¤ λ΅μ§
        elasticsearchClient.index(...)    // ESμ— μμ΅΄!
    }
}
```

**β… μΆ‹μ€ μ (μμ΅΄μ„± μ—­μ „)**
```kotlin
// Domain: μΈν„°νμ΄μ¤λ§ μ•κ³  μμ
class MessageService(
    private val consumer: MessageConsumer,    // μΈν„°νμ΄μ¤
    private val indexer: MessageIndexer       // μΈν„°νμ΄μ¤
) {
    fun process(message: Message) {  // μμν• λ„λ©”μΈ λ¨λΈ
        // λΉ„μ¦λ‹μ¤ λ΅μ§
        indexer.index(message)
    }
}

// Adapter: μ‹¤μ  κµ¬ν„
class KafkaConsumerAdapter : MessageConsumer { ... }
class ElasticsearchAdapter : MessageIndexer { ... }
```

### ν•µμ‹¬ μ›μΉ™

1. **λ„λ©”μΈμ΄ μ¤‘μ‹¬**: λΉ„μ¦λ‹μ¤ λ΅μ§μ΄ κ°€μ¥ μ¤‘μ”ν•΄μ”
2. **μμ΅΄μ„± μ—­μ „**: λ„λ©”μΈ β†’ μΈν„°νμ΄μ¤ β† μ–΄λ‘ν„°
3. **κµμ²΄ κ°€λ¥**: Kafkaλ¥Ό RabbitMQλ΅ λ°”κΏ”λ„ λ„λ©”μΈμ€ μ• λ°”λ€μ–΄μ”
4. **ν…μ¤νΈ μ©μ΄**: Mock κ°μ²΄λ΅ μ‰½κ² ν…μ¤νΈ κ°€λ¥

---

## π“– λ‹¤μ λ‹¨κ³„

**2λ‹¨κ³„: λ„λ©”μΈ λ¨λΈ λ§λ“¤κΈ°**λ΅ λ„μ–΄κ°‘λ‹λ‹¤!

κ°„λ‹¨ν• λ©”μ‹μ§€ λ¨λΈλ¶€ν„° μ‹μ‘ν•΄μ„ μ μ§„μ μΌλ΅ ν™•μ¥ν•  κ±°μμ”.